@page "/view-entries"
@inject MySimpleDictionaryService DictService
@using MudBlazor

<MudPaper Class="pa-4">
    <MudTable Items="entries">
        <HeaderContent>
            <MudTh>Key</MudTh>
            <MudTh>Value</MudTh>
            <MudTh>Actions</MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd>@context.Key</MudTd>
            <MudTd>@context.Value</MudTd>
            <MudTd>
                <MudButton Color="Color.Error" OnClick="@(() => RemoveEntry(context.Key))">
                    Remove
                </MudButton>
            </MudTd>
        </RowTemplate>
    </MudTable>

    <MudButton Color="Color.Error" Class="mt-2" OnClick="@ClearAll">
        Clear All
    </MudButton>
</MudPaper>

@code {
    private IEnumerable<KeyValuePair<string, string>> entries = Enumerable.Empty<KeyValuePair<string, string>>();

    protected override void OnInitialized()
    {
        LoadEntries();
        DictService.OnChange += Refresh;
    }

   private void LoadEntries() =>
    entries = DictService.GetAll();

    private void Refresh()
    {
        InvokeAsync(() =>
        {
            LoadEntries();
            StateHasChanged();
        });
    }

    private void RemoveEntry(string key) => DictService.Remove(key);

    private void ClearAll() => DictService.Clear();

    public void Dispose()
    {
        DictService.OnChange -= Refresh; // Sprečava curenje event handler-a
    }
}
